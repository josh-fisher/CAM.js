// CAM.js r1 - CAM.js
(function(b,h){function i(e){function c(){FU.LoadFile({fileType:FU.FILE_TYPE.TXT,loadMechanism:FU.LOAD_MECHANISM.XHR,remoteURL:b.RemoteRootPath.concat(b.AssetConfig),loaded:function(a){a=JSON.parse(a);g(a,"");for(a=0;a<b.Directories.length;a++){var c=b.LocalRootPath.concat(b.Directories[a]);FU.CreateDirectory(c,!1,function(){})}for(var d=0,a=0;a<b.Assets.length;a++){c=b.Assets[a];j(c.binary?FU.FILE_TYPE.BINARY:FU.FILE_TYPE.TXT,c.Filename);var j=function(a,c){FU.CheckFileSystemForFile(b.LocalRootPath.concat(c),
!1,function(f){f!==h?(d++,console.log("File: "+b.LocalRootPath.concat(c)+" is already on Local FileSystem"),d===b.Assets.length&&e()):FU.LoadFile({fileType:a,loadMechanism:FU.LOAD_MECHANISM.XHR,remoteURL:b.RemoteRootPath.concat(c),loaded:function(a){FU.SaveFile({remoteAsset:a,filePath:b.LocalRootPath.concat(c),temporary:!1,saved:function(a){d++;console.log(a+" Saved To local Filesystem");d===b.Assets.length&&e()}})}})})}}}})}FU.CreateDirectory(b.LocalRootPath,!1,function(){});FU.LoadFile({fileType:FU.FILE_TYPE.TXT,
loadMechanism:FU.LOAD_MECHANISM.XHR,remoteURL:b.RemoteRootPath.concat(b.VersionAsset),loaded:function(a){var f=JSON.parse(a);FU.CheckFileSystemForFile(b.LocalRootPath.concat(b.VersionAsset),!1,function(d){d!==h?FU.LoadFile({fileType:FU.FILE_TYPE.TXT,loadMechanism:FU.LOAD_MECHANISM.FILESYSTEM,file:d,loaded:function(d){JSON.parse(d).version!==f.version?(console.log("Assets have changed ... updating assets."),FU.SaveFile({remoteAsset:a,filePath:b.LocalRootPath.concat(b.VersionAsset),temporary:!1,saved:function(a){console.log(a+
" Saved To local Filesystem")}}),c()):(console.log("All assets are up to date!"),FU.LoadFile({fileType:FU.FILE_TYPE.TXT,loadMechanism:FU.LOAD_MECHANISM.XHR,remoteURL:b.RemoteRootPath.concat(b.AssetConfig),loaded:function(a){a=JSON.parse(a);g(a,"");e()}}))}}):(FU.SaveFile({remoteAsset:a,filePath:b.LocalRootPath.concat(b.VersionAsset),temporary:!1,saved:function(a){console.log(a+" Saved To local Filesystem")}}),c())})}})}function g(e,c){for(var a in e)if(e.hasOwnProperty(a)){var f=e[a];if(a!=="Files"){var d=
c+"/"+a;b.Directories.push(d);g(f,d)}else for(d=0;d<f.length;d++)f[d].Filename=c+"/"+f[d].Filename,b.Assets.push(f[d])}}if(!window.FU)throw Error("Required library FU.js is not loaded. Aborting ...");b.Assets=[];b.Directories=[];b.Initialize=function(e,c){FU.CLIENT_FEATURES.FilesystemAPI?FU.InitLocalFileSystem(function(){c?(e(),i(c)):i(e)}):(e(),FU.LoadFile({fileType:FU.FILE_TYPE.TXT,loadMechanism:FU.LOAD_MECHANISM.XHR,remoteURL:b.RemoteRootPath.concat(b.AssetConfig),loaded:function(a){a=JSON.parse(a);
g(a,"");c()}}))};b.GetPathFromFilename=function(e){for(var c=h,a=0;a<b.Assets.length;a++){var f=a,d=b.Assets[f],g=-1;d.Filename.indexOf(e)!==-1&&(g=f);if(g>=0){c=b.RemoteRootPath.concat(d.Filename);break}}return c};b.Load=function(e){var c,a,f,d;c=e.assetName;a=e.returnType;f=e.fileType;d=e.callback;FU.CLIENT_FEATURES.FilesystemAPI?FU.LoadFile({fileType:f,loadMechanism:FU.LOAD_MECHANISM.FILESYSTEM,fileName:c,returnType:a,temporary:!1,loaded:d}):(c=b.GetPathFromFilename(c),e.returnType&&a==="url"?
d(c):FU.LoadFile({fileType:f,loadMechanism:FU.LOAD_MECHANISM.XHR,remoteURL:c,loaded:d}))}})(window.CAM=window.CAM||{});
