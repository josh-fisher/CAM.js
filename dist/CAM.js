// CAM.js r1 - CAM.js
(function(a,h){function i(d){function c(){FU.LoadFile({fileType:FU.FILE_TYPE.TXT,loadMechanism:FU.LOAD_MECHANISM.XHR,remoteURL:a.RemoteRootPath.concat(a.AssetConfig),loaded:function(b){b=JSON.parse(b);g(b,"");for(b=0;b<a.Directories.length;b++){var e=a.LocalRootPath.concat(a.Directories[b]);FU.CreateDirectory(e,!1,function(){})}for(var f=0,b=0;b<a.Assets.length;b++){e=a.Assets[b];c(e.binary?FU.FILE_TYPE.BINARY:FU.FILE_TYPE.TXT,e.Filename);var c=function(b,c){FU.CheckFileSystemForFile(a.LocalRootPath.concat(c),
!1,function(e){e!==h?(f++,console.log("File: "+a.LocalRootPath.concat(c)+" is already on Local FileSystem"),f===a.Assets.length&&d()):FU.LoadFile({fileType:b,loadMechanism:FU.LOAD_MECHANISM.XHR,remoteURL:a.RemoteRootPath.concat(c),loaded:function(b){FU.SaveFile({remoteAsset:b,filePath:a.LocalRootPath.concat(c),temporary:!1,saved:function(b){f++;console.log(b+" Saved To local Filesystem");f===a.Assets.length&&d()}})}})})}}}})}FU.CreateDirectory(a.LocalRootPath,!1,function(){});FU.LoadFile({fileType:FU.FILE_TYPE.TXT,
loadMechanism:FU.LOAD_MECHANISM.XHR,remoteURL:a.RemoteRootPath.concat(a.VersionAsset),loaded:function(b){var e=JSON.parse(b);FU.CheckFileSystemForFile(a.LocalRootPath.concat(a.VersionAsset),!1,function(f){f!==h?FU.LoadFile({fileType:FU.FILE_TYPE.TXT,loadMechanism:FU.LOAD_MECHANISM.FILESYSTEM,file:f,loaded:function(f){JSON.parse(f).version!==e.version?(console.log("Assets have changed ... updating assets."),FU.SaveFile({remoteAsset:b,filePath:a.LocalRootPath.concat(a.VersionAsset),temporary:!1,saved:function(a){console.log(a+
" Saved To local Filesystem")}}),c()):(console.log("All assets are up to date!"),FU.LoadFile({fileType:FU.FILE_TYPE.TXT,loadMechanism:FU.LOAD_MECHANISM.XHR,remoteURL:a.RemoteRootPath.concat(a.AssetConfig),loaded:function(a){a=JSON.parse(a);g(a,"");d()}}))}}):(FU.SaveFile({remoteAsset:b,filePath:a.LocalRootPath.concat(a.VersionAsset),temporary:!1,saved:function(a){console.log(a+" Saved To local Filesystem")}}),c())})}})}function g(d,c){for(var b in d)if(d.hasOwnProperty(b)){var e=d[b];if(b!=="Files"){var f=
c+"/"+b;a.Directories.push(f);g(e,f)}else for(f=0;f<e.length;f++)e[f].Filename=c+"/"+e[f].Filename,a.Assets.push(e[f])}}if(!window.FU)throw Error("Required library FU.js is not loaded. Aborting ...");a.Assets=[];a.Directories=[];a.Initialize=function(d,c){FU.CLIENT_FEATURES.FilesystemAPI?FU.InitLocalFileSystem(function(){c?(d(),i(c)):i(d)}):(d(),FU.LoadFile({fileType:FU.FILE_TYPE.TXT,loadMechanism:FU.LOAD_MECHANISM.XHR,remoteURL:a.RemoteRootPath.concat(a.AssetConfig),loaded:function(a){a=JSON.parse(a);
g(a,"");c()}}))};a.GetPathFromFilename=function(d){var c=h;$.each(a.Assets,function(b,e){var f=-1;e.Filename.indexOf(d)!==-1&&(f=b);if(f>=0)return c=a.RemoteRootPath.concat(e.Filename),!0});return c};a.Load=function(d){var c,b,e;c=d.assetName;b=d.returnType;e=d.fileType;d=d.callback;FU.CLIENT_FEATURES.FilesystemAPI?FU.LoadFile({fileType:e,loadMechanism:FU.LOAD_MECHANISM.FILESYSTEM,fileName:c,returnType:b,temporary:!1,loaded:d}):(c=a.GetPathFromFilename(c),FU.LoadFile({fileType:e,loadMechanism:FU.LOAD_MECHANISM.XHR,
remoteURL:c,loaded:d}))}})(window.CAM=window.CAM||{});
