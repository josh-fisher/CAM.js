// CAM.js r1 (02/17/2012) - CAM.js
(function(a,i){function j(f){function d(){FU.LoadFile({fileType:FU.FILE_TYPE.TXT,loadMechanism:FU.LOAD_MECHANISM.XHR,remoteURL:a.RemoteRootPath.concat(a.AssetConfig),loaded:function(b){b=JSON.parse(b);h(b,"");for(b=0;b<a.Directories.length;b++){var e=a.LocalRootPath.concat(a.Directories[b]);FU.CreateDirectory(e,!1,function(){})}for(var c=0,b=0;b<a.Assets.length;b++){e=a.Assets[b];d(e.binary?FU.FILE_TYPE.BINARY:FU.FILE_TYPE.TXT,e.Filename);var d=function(b,d){FU.CheckFileSystemForFile(a.LocalRootPath.concat(d),
!1,function(e){e!==i?(c++,console.log("File: "+a.LocalRootPath.concat(d)+" is already on Local FileSystem"),c===a.Assets.length&&f()):FU.LoadFile({fileType:b,loadMechanism:FU.LOAD_MECHANISM.XHR,remoteURL:a.RemoteRootPath.concat(d),loaded:function(b){FU.SaveFile({remoteAsset:b,filePath:a.LocalRootPath.concat(d),temporary:!1,saved:function(b){c++;console.log(b+" Saved To local Filesystem");c===a.Assets.length&&f()}})}})})}}}})}FU.CreateDirectory(a.LocalRootPath,!1,function(){});FU.LoadFile({fileType:FU.FILE_TYPE.TXT,
loadMechanism:FU.LOAD_MECHANISM.XHR,remoteURL:a.RemoteRootPath.concat(a.VersionAsset),loaded:function(b){var e=JSON.parse(b);FU.CheckFileSystemForFile(a.LocalRootPath.concat(a.VersionAsset),!1,function(c){c!==i?FU.LoadFile({fileType:FU.FILE_TYPE.TXT,loadMechanism:FU.LOAD_MECHANISM.FILESYSTEM,file:c,loaded:function(c){JSON.parse(c).version!==e.version?(console.log("Assets have changed ... updating assets."),FU.SaveFile({remoteAsset:b,filePath:a.LocalRootPath.concat(a.VersionAsset),temporary:!1,saved:function(a){console.log(a+
" Saved To local Filesystem")}}),d()):(console.log("All assets are up to date!"),FU.LoadFile({fileType:FU.FILE_TYPE.TXT,loadMechanism:FU.LOAD_MECHANISM.XHR,remoteURL:a.RemoteRootPath.concat(a.AssetConfig),loaded:function(a){a=JSON.parse(a);h(a,"");f()}}))}}):(FU.SaveFile({remoteAsset:b,filePath:a.LocalRootPath.concat(a.VersionAsset),temporary:!1,saved:function(a){console.log(a+" Saved To local Filesystem")}}),d())})}})}function h(f,d){for(var b in f)if(f.hasOwnProperty(b)){var e=f[b];if(b!=="Files"){var c=
d+"/"+b;a.Directories.push(c);h(e,c)}else for(c=0;c<e.length;c++)e[c].Filename=d+"/"+e[c].Filename,a.Assets.push(e[c])}}if(!window.FU)throw Error("Required library FU.js is not loaded. Aborting ...");a.Assets=[];a.Directories=[];a.Initialized=!1;a.Initialize=function(f,d){FU.CLIENT_FEATURES.FilesystemAPI?FU.InitLocalFileSystem(function(){d?(j(d),a.Initialized=!0,f()):j(f)}):(a.Initialized=!0,f(),FU.LoadFile({fileType:FU.FILE_TYPE.TXT,loadMechanism:FU.LOAD_MECHANISM.XHR,remoteURL:a.RemoteRootPath.concat(a.AssetConfig),
loaded:function(a){a=JSON.parse(a);h(a,"");d()}}))};a.GetPathFromFilename=function(f){for(var d=i,b=0;b<a.Assets.length;b++){var e=b,c=a.Assets[e],g=-1;c.Filename.indexOf(f)!==-1&&(g=e);if(g>=0){d=a.RemoteRootPath.concat(c.Filename);break}}return d};a.Load=function(f){var d,b,e,c,g;d=f.assetName;e=f.returnType;c=f.fileType;sliceParams=f.sliceParams;b=f.file;g=f.callback;FU.CLIENT_FEATURES.FilesystemAPI?b?FU.LoadFile({fileType:c,loadMechanism:FU.LOAD_MECHANISM.FILE,file:b,returnType:e,temporary:!1,
sliceParams:sliceParams,loaded:g}):FU.LoadFile({fileType:c,loadMechanism:FU.LOAD_MECHANISM.FILESYSTEM,fileName:d,returnType:e,temporary:!1,sliceParams:sliceParams,loaded:g}):FU.CLIENT_FEATURES.FileAPI&&b?FU.LoadFile({fileType:c,loadMechanism:FU.LOAD_MECHANISM.FILE,file:b,returnType:e,temporary:!1,sliceParams:sliceParams,loaded:g}):(d=a.GetPathFromFilename(d),f.returnType&&e==="url"?g(d):FU.LoadFile({fileType:c,loadMechanism:FU.LOAD_MECHANISM.XHR,remoteURL:d,sliceParams:sliceParams,loaded:g}))}})(window.CAM=
window.CAM||{});
